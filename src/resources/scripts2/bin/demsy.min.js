
Dnls={login:"登录",alerts:{error:"错误",info:"提示",warn:"警告",success:"成功",confirm:"确认",prompt:"提示"},buttons:{ok:"确定",cancel:"取消"}};Dtpl={dialog:'<div class="dialog" style="top:150px; left:300px;">'+'<div class="dialogHeader" onselectstart="return false;" oncopy="return false;" onpaste="return false;" oncut="return false;">'+'	<div class="dialogHeader_r">'+'		<div class="dialogHeader_c">'+'			<a class="close" href="#close">close</a>'+'			<a class="maximize" href="#maximize">maximize</a>'+'			<a class="restore" href="#restore">restore</a>'+'			<a class="minimize" href="#minimize">minimize</a>'+'			<h1></h1>'+'		</div>'+'	</div>'+'</div>'+'<div class="dialogContent layoutBox unitBox">'+'</div>'+'<div class="dialogFooter"><div class="dialogFooter_r"><div class="dialogFooter_c"></div></div></div>'+'<div class="resizable_h_l" tar="nw"></div>'+'<div class="resizable_h_r" tar="ne"></div>'+'<div class="resizable_h_c" tar="n"></div>'+'<div class="resizable_c_l" tar="w" style="height:300px;"></div>'+'<div class="resizable_c_r" tar="e" style="height:300px;"></div>'+'<div class="resizable_f_l" tar="sw"></div>'+'<div class="resizable_f_r" tar="se"></div>'+'<div class="resizable_f_c" tar="s"></div>'+'</div>'};Durl={login:"/login/load"};Dstatus={ok:200,error:300,timeout:301};DkeyCode={ENTER:13,ESC:27,END:35,HOME:36,SHIFT:16,TAB:9,LEFT:37,RIGHT:39,UP:38,DOWN:40,DELETE:46,BACKSPACE:8};Dfield={pageIndex:"pageIndex",pageSize:"pageSize",orderBy:"orderBy"};Dmsg={};(function($){$.alerts={verticalOffset:-75,horizontalOffset:0,repositionOnResize:true,overlayOpacity:.01,overlayColor:'#FFF',draggable:true,dialogClass:null,_show:function(title,msg,value,type,callback){$.alerts._hide();$.alerts._overlay('show');var $container=$('<div id="alerts_container"><h1 id="alerts_title"></h1><div id="alerts_content"><div class="alerts_logo"></div><div id="alerts_message"></div></div></div>').appendTo($("BODY"));if($.alerts.dialogClass)$container.addClass($.alerts.dialogClass);var pos=($.browser.msie&&parseInt($.browser.version)<=6)?'absolute':'fixed';$container.css({position:pos,zIndex:99999,padding:0,margin:0});var $title=$("#alerts_title",$container).text(title);var $content=$("#alerts_content",$container).addClass(type);var $message=$("#alerts_message",$container).html(msg.replace(/\n/g,'<br />'));$container.css({minWidth:$container.outerWidth(),maxWidth:$container.outerWidth()});$.alerts._reposition();$.alerts._bindWindowResize(true);switch(type){case 'confirm':$message.after('<div id="alerts_panel"><input type="button" value="{0};" id="alerts_ok" /><input type="button" value="{1};" id="alerts_cancel" /></div>'.format(Dnls.buttons.ok,Dnls.buttons.cancel));var $ok=$("#alerts_ok",$container);var $cancel=$("#alerts_cancel",$container);$ok.click(function(){$.alerts._hide();if(callback)callback(true);}).focus().keypress(function(e){if(e.keyCode==DkeyCode.ENTER)$ok.trigger('click');if(e.keyCode==DkeyCode.ESC)$cancel.trigger('click');});$cancel.click(function(){$.alerts._hide();if(callback)callback(false);}).keypress(function(e){if(e.keyCode==DkeyCode.ENTER)$ok.trigger('click');if(e.keyCode==DkeyCode.ESC)$cancel.trigger('click');});break;case 'prompt':$message.append('<br /><input type="text" size="30" id="alerts_prompt" />').after('<div id="alerts_panel"><input type="button" value="{0};" id="alerts_ok" /><input type="button" value="{1};" id="alerts_cancel" /></div>'.format(Dnls.buttons.ok,Dnls.buttons.cancel));var $prompt=$("#alerts_prompt",$container).width($message.width());var $ok=$("#alerts_ok",$container);var $cancel=$("#alerts_cancel",$container);$ok.click(function(){var val=$prompt.val();$.alerts._hide();if(callback)callback(val);}).keypress(function(e){if(e.keyCode==DkeyCode.ENTER)$ok.trigger('click');if(e.keyCode==DkeyCode.ESC)$cancel.trigger('click');});$cancel.click(function(){$.alerts._hide();if(callback)callback(null);}).keypress(function(e){if(e.keyCode==DkeyCode.ENTER)$ok.trigger('click');if(e.keyCode==DkeyCode.ESC)$cancel.trigger('click');});if(value)$prompt.val(value);$prompt.focus().select();break;default:$message.after('<div id="alerts_panel"><input type="button" value="{0};" id="alerts_ok" /></div>'.format(Dnls.buttons.ok));var $ok=$("#alerts_ok",$container);$ok.click(function(){$.alerts._hide();if(callback)callback(true);}).focus().keypress(function(e){if(e.keyCode==DkeyCode.ENTER||e.keyCode==DkeyCode.ESC)$ok.trigger('click');});break;};if($.alerts.draggable){try{$container.draggable({handle:$title});$title.css({cursor:'move'});}catch(e){alert(e);}}},_hide:function(){$("#alerts_container").remove();$.alerts._overlay('hide');$.alerts._bindWindowResize(false);},_overlay:function(status){switch(status){case 'show':$.alerts._overlay('hide');$('<div id="alerts_overlay"></div>').css({position:'absolute',zIndex:99998,top:'0px',left:'0px',width:'100%',height:$(document).height(),background:$.alerts.overlayColor,opacity:$.alerts.overlayOpacity}).appendTo($("BODY"));break;case 'hide':$("#alerts_overlay").remove();break;}},_reposition:function(){var $container=$("#alerts_container");var $window=$(window);var top=(($window.height()/2)-($container.outerHeight()/2))+$.alerts.verticalOffset;var left=(($window.width()/2)-($container.outerWidth()/2))+$.alerts.horizontalOffset;if(top<0)top=0;if(left<0)left=0;if($.browser.msie&&parseInt($.browser.version)<=6)top=top+$window.scrollTop();$container.css({top:top+'px',left:left+'px'});$("#alerts_overlay").height($(document).height());},_bindWindowResize:function(status){if($.alerts.repositionOnResize){switch(status){case true:$(window).bind('resize',$.alerts._reposition);break;case false:$(window).unbind('resize',$.alerts._reposition);break;}}}};Dalert=function(message,title,type,callback){$.alerts._show(title,message,null,type,function(result){if(callback)callback(result);});};Derror=function(message,title,callback){Dalert(message,title||Dnls.alerts.error,"error",callback);};Dwarn=function(message,title,callback){Dalert(message,title||Dnls.alerts.warn,"warn",callback);};Dinfo=function(message,title,callback){Dalert(message,title||Dnls.alerts.info,"info",callback);};Dsuccess=function(message,title,callback){Dalert(message,title||Dnls.alerts.success,"success",callback);};Dconfirm=function(message,title,callback){$.alerts._show(title||Dnls.alerts.confirm,message,null,'confirm',function(result){if(callback)callback(result);});};Dprompt=function(message,value,title,callback){$.alerts._show(title||Dnls.alerts.prompt,message,value,'prompt',function(result){if(callback)callback(result);});};})(jQuery);Map=function(){this.elements=new Array();this.size=function(){return this.elements.length;};this.isEmpty=function(){return(this.elements.length<1);};this.clear=function(){this.elements=new Array();};this.put=function(_key,_value){this.remove(_key);this.elements.push({key:_key,value:_value});};this.remove=function(_key){try{for(i=0;i<this.elements.length;i++){if(this.elements[i].key==_key){this.elements.splice(i,1);return true;}}}catch(e){return false;};return false;};this.get=function(_key){try{for(i=0;i<this.elements.length;i++){if(this.elements[i].key==_key){return this.elements[i].value;}}}catch(e){return null;}};this.element=function(_index){if(_index<0||_index>=this.elements.length){return null;};return this.elements[_index];};this.containsKey=function(_key){try{for(i=0;i<this.elements.length;i++){if(this.elements[i].key==_key){return true;}}}catch(e){return false;};return false;};this.values=function(){var arr=new Array();for(i=0;i<this.elements.length;i++){arr.push(this.elements[i].value);};return arr;};this.keys=function(){var arr=new Array();for(i=0;i<this.elements.length;i++){arr.push(this.elements[i].key);};return arr;}};var __sti=setInterval;window.setInterval=function(callback,timeout,param){var args=Array.prototype.slice.call(arguments,2);var _cb=function(){callback.apply(null,args);};__sti(_cb,timeout);};var __sto=setTimeout;window.setTimeout=function(callback,timeout,param){var args=Array.prototype.slice.call(arguments,2);var _cb=function(){callback.apply(null,args);};__sto(_cb,timeout);};(function($){$.extend(String.prototype,{isPositiveInteger:function(){return(new RegExp(/^[1-9]\d*$/).test(this));},isInteger:function(){return(new RegExp(/^\d+$/).test(this));},isNumber:function(value,element){return(new RegExp(/^-?(?:\d+|\d{1,3};(?:,\d{3})+)(?:\.\d+)?$/).test(this));},trim:function(){return this.replace(/(^\s*)|(\s*$)|\r|\n/g,"");},startsWith:function(pattern){return this.indexOf(pattern)===0;},endsWith:function(pattern){var d=this.length-pattern.length;return d>=0&&this.lastIndexOf(pattern)===d;},replaceSuffix:function(index){return this.replace(/\[[0-9]+\]/,'['+index+']').replace('#index#',index);},trans:function(){return this.replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"');},replaceAll:function(os,ns){return this.replace(new RegExp(os,"gm"),ns);},replaceTm:function($data){if(!$data)return this;return this.replace(RegExp("({[A-Za-z_]+[A-Za-z0-9_]*})","g"),function($1){return $data[$1.replace(/[{}]+/g,"")];});},replaceTmById:function(_box){var $parent=_box||$(document);return this.replace(RegExp("({[A-Za-z_]+[A-Za-z0-9_]*})","g"),function($1){var $input=$parent.find("#"+$1.replace(/[{}]+/g,""));return $input.val()?$input.val():$1;});},isFinishedTm:function(){return !(new RegExp("{[A-Za-z_]+[A-Za-z0-9_]*};").test(this));},skipChar:function(ch){if(!this||this.length===0){return '';};if(this.charAt(0)===ch){return this.substring(1).skipChar(ch);};return this;},isPassword:function(){return(new RegExp(/^([_]|[a-zA-Z0-9]){6,32};$/).test(this));},isEmail:function(){return(new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/).test(this.trim()));},isSpaces:function(){for(var i=0;i<this.length;i+=1){var ch=this.charAt(i);if(ch!=' '&&ch!="\n"&&ch!="\t"&&ch!="\r"){return false;}};return true;},isPhone:function(){return(new RegExp(/(^([0-9]{3,4};[-])?\d{3,8};(-\d{1,6})?$)|(^\([0-9]{3,4};\)\d{3,8};(\(\d{1,6};\))?$)|(^\d{3,8};$)/).test(this));},isUrl:function(){return(new RegExp(/^[a-zA-z]+:\/\/([a-zA-Z0-9\-\.]+)([-\w .\/?%&=:]*)$/).test(this));},isExternalUrl:function(){return this.isUrl()&&this.indexOf("://"+document.domain)==-1;},toProp:function(){var idx=this.indexOf("-");if(idx>-1){var str=this.substring(0,idx)+this.substring(idx+1,idx+2).toUpperCase()+this.substring(idx+2);return str.toProp();};return this;},format:function(){var args=arguments||[];var result=this;for(var i=0;i<args.length;i++){result=result.replace(new RegExp("\\{"+i+"\\};","g"),args[i]);};return result;}});})(jQuery);Dutils={_debug:false,isOverAxis:function(x,ref,size){return(x>ref)&&(x<(ref+size));},isOver:function(y,x,top,left,height,width){return this.isOverAxis(y,top,height)&&this.isOverAxis(x,left,width);},log:function(msg){if(this._debug){if(typeof(console)!="undefined")console.log(msg);else alert(msg);}},login:function(title){if($.pdialog&&Durl.login){$.pdialog.open(Durl.login,"login",title||Dnls.login,{mask:true,width:520,height:260});}else{window.location=Durl.login;}},toJson:function(str){try{if($.type(str)=='string')return eval('('+str+')');else return str;}catch(e){return{};}},ajaxError:function(xhr,ajaxOptions,thrownError){Derror("<div>Http status: "+xhr.status+" "+xhr.statusText+"</div>"+"<div>ajaxOptions: "+ajaxOptions+"</div>"+"<div>thrownError: "+thrownError+"</div>"+"<div>"+xhr.responseText+"</div>");},ajaxDone:function(json){if(json.statusCode===undefined&&json.message===undefined){return Derror(json);};if(json.statusCode==Dstatus.error&&json.message){Derror(json.message);}else if(json.statusCode==Dstatus.timeout){Dutils.login();}else if(json.message){Dsuccess(json.message);}},};(function($){$.fn.extend({dajax:function(options){if($.fn.xheditor){$("textarea.editor",this).xheditor(false);};$.ajax({type:options.type||'GET',url:options.url,data:options.data,cache:false,success:function(response){var json=Dutils.toJson(response);if(json.statusCode==Dstatus.timeout){Dutils.login(json.message||Dmsg("sessionTimout"));}else if(json.statusCode==Dstatus.error){Derror(json.message);}else{$this.html(response).demsyInit();if($.isFunction(options.callback))options.callback(response);}},error:Dutils.ajaxError});},dget:function(url,data,callback){this.dajax({url:url,data:data,callback:callback});},dpost:function(url,data,callback){this.dajax({url:url,type:"POST",data:data,callback:callback});},dinit:function(){return this.each(function(){if($.isFunction(initUI))initUI(this);});},dlayout:function($refBox){return this.each(function(){var $this=$(this);if(!$refBox)$refBox=$this.parents("div.layoutBox:first");var iRefH=$refBox.height();var iLayoutH=parseInt($this.attr("layoutH"));var iH=iRefH-iLayoutH>50?iRefH-iLayoutH:50;if($this.isTag("table")){$this.removeAttr("layoutH").wrap('<div layoutH="'+iLayoutH+'" style="overflow:auto;height:'+iH+'px"></div>');}else{$this.height(iH).css("overflow","auto");}});},hoverClass:function(className){var _className=className||"hover";return this.each(function(){$(this).hover(function(){$(this).addClass(_className);},function(){$(this).removeClass(_className);});});},focusClass:function(className){var _className=className||"textInputFocus";return this.each(function(){$(this).focus(function(){$(this).addClass(_className);}).blur(function(){$(this).removeClass(_className);});});},altBox:function(){return this.each(function(){var $this=$(this);function getAltBox(){return $this.parent().find("label.alt");};function altBoxCss(opacity){var position=$this.position();return{width:$this.width(),top:position.top+'px',left:position.left+'px',opacity:opacity||1}};if(getAltBox().size()<1){if(!$this.attr("id"))$this.attr("id",$this.attr("name")+"_"+Math.round(Math.random()*10000));var $label=$('<label class="alt" for="'+$this.attr("id")+'">'+$this.attr("alt")+'</label>').appendTo($this.parent());$label.css(altBoxCss(1));if($this.val())$label.hide();};$this.focus(function(){getAltBox().css(altBoxCss(0.3));}).blur(function(){if(!$(this).val())getAltBox().show().css("opacity",1);}).keydown(function(){getAltBox().hide();});});},isTag:function(tn){if(!tn)return false;return this.tagName.toLowerCase()==tn.toLowerCase()?true:false;},hasEvent:function(type){var _events=$(this).data("events");return _events&&type&&_events[type];},log:function(msg){return this.each(function(){if(console)console.log("%s: %o",msg,this);});}});})(jQuery);(function($){function drag(e){var opts=$.data(e.data.target,'draggable').options;var dragData=e.data;var left=dragData.startLeft+e.pageX-dragData.startX;var top=dragData.startTop+e.pageY-dragData.startY;if(opts.deltaX!=null&&opts.deltaX!=undefined){left=e.pageX+opts.deltaX;};if(opts.deltaY!=null&&opts.deltaY!=undefined){top=e.pageY+opts.deltaY;};if(e.data.parnet!=document.body){if($.boxModel==true){left+=$(e.data.parent).scrollLeft();top+=$(e.data.parent).scrollTop();}};if(opts.axis=='h'){dragData.left=left;}else if(opts.axis=='v'){dragData.top=top;}else{dragData.left=left;dragData.top=top;}};function applyDrag(e){var opts=$.data(e.data.target,'draggable').options;var proxy=$.data(e.data.target,'draggable').proxy;if(proxy){proxy.css('cursor',opts.cursor);}else{proxy=$(e.data.target);$.data(e.data.target,'draggable').handle.css('cursor',opts.cursor);};proxy.css({left:e.data.left,top:e.data.top});};function doDown(e){var opts=$.data(e.data.target,'draggable').options;var droppables=$('.droppable').filter(function(){return e.data.target!=this;}).filter(function(){var accept=$.data(this,'droppable').options.accept;if(accept){return $(accept).filter(function(){return this==e.data.target;}).length>0;}else{return true;}});$.data(e.data.target,'draggable').droppables=droppables;var proxy=$.data(e.data.target,'draggable').proxy;if(!proxy){if(opts.proxy){if(opts.proxy=='clone'){proxy=$(e.data.target).clone().insertAfter(e.data.target);}else{proxy=opts.proxy.call(e.data.target,e.data.target);};$.data(e.data.target,'draggable').proxy=proxy;}else{proxy=$(e.data.target);}};proxy.css('position','absolute');drag(e);applyDrag(e);opts.onStartDrag.call(e.data.target,e);return false;};function doMove(e){drag(e);if($.data(e.data.target,'draggable').options.onDrag.call(e.data.target,e)!=false){applyDrag(e);};var source=e.data.target;$.data(e.data.target,'draggable').droppables.each(function(){var dropObj=$(this);var p2=$(this).offset();if(e.pageX>p2.left&&e.pageX<p2.left+dropObj.outerWidth()&&e.pageY>p2.top&&e.pageY<p2.top+dropObj.outerHeight()){if(!this.entered){$(this).trigger('_dragenter',[source]);this.entered=true;};$(this).trigger('_dragover',[source]);}else{if(this.entered){$(this).trigger('_dragleave',[source]);this.entered=false;}}});return false;};function doUp(e){drag(e);var proxy=$.data(e.data.target,'draggable').proxy;var opts=$.data(e.data.target,'draggable').options;if(opts.revert){if(checkDrop()==true){removeProxy();$(e.data.target).css({position:e.data.startPosition,left:e.data.startLeft,top:e.data.startTop});}else{if(proxy){proxy.animate({left:e.data.startLeft,top:e.data.startTop},function(){removeProxy();});}else{$(e.data.target).animate({left:e.data.startLeft,top:e.data.startTop},function(){$(e.data.target).css('position',e.data.startPosition);});}}}else{$(e.data.target).css({position:'absolute',left:e.data.left,top:e.data.top});removeProxy();checkDrop();};opts.onStopDrag.call(e.data.target,e);function removeProxy(){if(proxy){proxy.remove();};$.data(e.data.target,'draggable').proxy=null;};function checkDrop(){var dropped=false;$.data(e.data.target,'draggable').droppables.each(function(){var dropObj=$(this);var p2=$(this).offset();if(e.pageX>p2.left&&e.pageX<p2.left+dropObj.outerWidth()&&e.pageY>p2.top&&e.pageY<p2.top+dropObj.outerHeight()){if(opts.revert){$(e.data.target).css({position:e.data.startPosition,left:e.data.startLeft,top:e.data.startTop});};$(this).trigger('_drop',[e.data.target]);dropped=true;this.entered=false;}});return dropped;};$(document).unbind('.draggable');return false;};$.fn.draggable=function(options){if(typeof options=='string'){switch(options){case 'options':return $.data(this[0],'draggable').options;case 'proxy':return $.data(this[0],'draggable').proxy;case 'enable':return this.each(function(){$(this).draggable({disabled:false});});case 'disable':return this.each(function(){$(this).draggable({disabled:true});});}};return this.each(function(){var opts;var state=$.data(this,'draggable');if(state){state.handle.unbind('.draggable');opts=$.extend(state.options,options);}else{opts=$.extend({},$.fn.draggable.defaults,options||{});};if(opts.disabled==true){$(this).css('cursor','default');return;};var handle=null;if(typeof opts.handle=='undefined'||opts.handle==null){handle=$(this);}else{handle=(typeof opts.handle=='string'?$(opts.handle,this):opts.handle);};$.data(this,'draggable',{options:opts,handle:handle});handle.bind('mousedown.draggable',{target:this},onMouseDown);handle.bind('mousemove.draggable',{target:this},onMouseMove);function onMouseDown(e){if(checkArea(e)==false)return;var position=$(e.data.target).position();var data={startPosition:$(e.data.target).css('position'),startLeft:position.left,startTop:position.top,left:position.left,top:position.top,startX:e.pageX,startY:e.pageY,target:e.data.target,parent:$(e.data.target).parent()[0]};$(document).bind('mousedown.draggable',data,doDown);$(document).bind('mousemove.draggable',data,doMove);$(document).bind('mouseup.draggable',data,doUp);};function onMouseMove(e){if(checkArea(e)){$(this).css('cursor',opts.cursor);}else{$(this).css('cursor','default');}};function checkArea(e){var offset=$(handle).offset();var width=$(handle).outerWidth();var height=$(handle).outerHeight();var t=e.pageY-offset.top;var r=offset.left+width-e.pageX;var b=offset.top+height-e.pageY;var l=e.pageX-offset.left;return Math.min(t,r,b,l)>opts.edge;}});};$.fn.draggable.defaults={proxy:null,revert:false,cursor:'move',deltaX:null,deltaY:null,handle:null,disabled:false,edge:0,axis:null,onStartDrag:function(e){},onDrag:function(e){},onStopDrag:function(e){}};})(jQuery);


